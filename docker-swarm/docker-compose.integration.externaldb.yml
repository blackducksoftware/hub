version: '3.6'
# Starting with the 2019.2.0 release: DO NOT EDIT THIS FILE!!!
# ADD ANY OF YOUR OVERRIDES IN THE docker-compose.local-overrides.yml FILE
# Refer to the Release Notes or Installation Guide for more information.

services:
  integration:
    image: blackducksoftware/blackduck-integration:2024.7.0
    user: integration:root
    env_file: [blackduck-config.env , hub-postgres.env]
    healthcheck:
      test: [CMD, /usr/local/bin/docker-healthcheck.sh, 'https://localhost:8443/api/health-checks/liveness',
        /opt/blackduck/hub/blackduck-integration/security/root.crt, /opt/blackduck/hub/blackduck-integration/security/blackduck_system.crt,
        /opt/blackduck/hub/blackduck-integration/security/blackduck_system.key]
      interval: 30s
      timeout: 60s
      retries: 15
      start_period: 14400s
    environment:
      HUB_POSTGRES_IS_EXTERNAL: "true"
      HUB_POSTGRES_PARAMETER_LIMIT: 12000
      HUB_MAX_MEMORY: "4608m"
      HUB_JOBRUNNER_HOST: 'tasks.jobrunner.'
      SYNOPSYS_CRYPTO_PROFILE: 'SWARM'
    volumes:
    - {type: tmpfs, target: /opt/blackduck/hub/hub-integration/security}
    deploy:
      mode: replicated
      restart_policy: {condition: on-failure, delay: 5s, window: 60s}
      resources:
        limits:
          cpus: "1.000"
          memory: "5120M"
        reservations:
          cpus: ".500"
          memory: "3584M"
      replicas: 1
  webserver:
    environment: {ENABLE_INTEGRATION_SERVICE: "true"}
